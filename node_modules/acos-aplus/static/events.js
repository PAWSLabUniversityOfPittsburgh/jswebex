(function ($) {
  'use strict';

  var ACOS = function() {};
  
  ACOS.sendEvent = function(event, payload) {
  
    var protocolData = { "submissionURL" : $('input[name="submission_url"]').attr('value') };
  
    var target = window.location.pathname;
    if (target[target.length - 1] == '/') {
        target = target.substring(0, target.length - 1);
    }  

    //TODO: error handling

    $.post(target + "/event", {                              
                             "event" : event,  
                             "payload" : JSON.stringify(payload),
                             "protocolData" : JSON.stringify(protocolData)                             
    }).done(function(response) {
        if (event == 'grade') {
            // Update the points view            
            window.parent.postMessage({type: 'a-plus-refresh-stats'}, "*");
        }        
    }).fail(function(jqXHR, text) {
      console.log(jqXHR, text);
    });
  
  };
  
  // Make the namespace globally available
  window.ACOS = ACOS;
  
}(jQuery));
