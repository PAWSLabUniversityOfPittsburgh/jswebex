var htmlencode = require('htmlencode').htmlEncode;

var Annotated = function() {};

Annotated.addToHead = function(params) {
    return '<script src="/static/annotated-demo/example.js" type="text/javascript"></script>\n';
};

Annotated.addToBody = function(params) {
    return '<div class="annotated-example" data-id="' + htmlencode(params.name) + '"></div>';
};

Annotated.initialize = function(req, params, handlers, cb) {

    // Initialize the content package
    params.headContent += Annotated.addToHead(params);
    params.bodyContent += Annotated.addToBody(params);

    cb();

};

Annotated.register = function(handlers) {
    handlers.contentPackages['annotated-demo'] = Annotated;
    handlers.contentTypes.annotated.installedContentPackages.push(Annotated);
};

Annotated.namespace = 'annotated-demo';
Annotated.contentTypeNamespace = 'annotated';

Annotated.meta = {
    'name': 'annotated-demo',
    'shortDescription': 'A demonstration for annotated examples.',
    'description': 'Annotated Examples',
    'author': 'Hardik Vasa',
    'license': 'MIT',
    'version': '0.0.1',
    'url': '',
    'teaserContent1' : ['HelloWorld','Simple_Printing','Simple_Calculations','Arithmatic_Operations','Variable_Type_Numbers','Variable_Type_Strings','Variable_Assignment','Multiple_Variable_Assignment','Assignment_Operators','Different_Ways_To_Print'],
    'teaserContent2' : ['Simple_Input','Simple_Input_2'],
    'teaserContent3' : ['Compariso_Operator'],
    'teaserContent4' : ['If_Statement','If_Else_Statement','If_Else_Statement_2','ElIf_Statement','Nested_If_Else_Statement','Nested_If_Else_Statement_2','Complex_If_Else_Statement'],
    'teaserContent5' : ['Logical_Operators','If_Else_Statement'],
    'teaserContent6' : ['While_Loop_Statement','While_Loop_Statement_2','For_Loop_Statement','Nested_Loops'],
    'teaserContent7' : ['Output_Formatting','Output_Formatting_2'],
    'teaserContent8' : ['Functions_Introduction','Functions_With_Arguments','Functions_Example_1','Functions_Example_2'],
    'teaserContent9' : ['List_Basics','Variable_Type_List','Accessing_The_List_Index','Replacing_List_Elements','Appending_Values_To_List','Adding_Lists'],
    'teaserContent10' : ['Sub_Strings','Adding_Strings','Escape_Characters'],
    'teaserContent11' : ['Dictionary_Basics','Adding_Dictionary','Modify_Dictionary_Elements'],
    'teaserContent12' : ['References_Basics'],
    'teaserContent13' : ['Exceptions_Basics','Exceptions_2','Exceptions_3'],
    'teaserContent14' : ['Reading_from_file','Writing_to_file'],
    'teaserContent15' : ['class_calculator','class_bank_account','class_inheritance'],
    'contents': {
        'demo': {
            'description': 'Hello!',
            'order': 0,
            'title': 'Demo'
        }
    }
};

module.exports = Annotated;


//mysql queries
var mysql = require('mysql');

var conn = mysql.createConnection({
    host: "localhost",
    user: "",
    password: "",
    database: ""
    }
);

//Records with code and comments
var queryString = "SELECT aggregate.ent_topic.display_name AS topic_name,aggregate.rel_topic_content.display_name AS rdf_id,webex21.ent_dissection.Name AS ex_name,webex21.ent_line.LineIndex AS line_number,webex21.ent_line.Code as code,webex21.ent_line.Comment AS comment " +
    "FROM aggregate.ent_topic,aggregate.rel_topic_content,aggregate.rel_resource_provider,webex21.ent_dissection,webex21.ent_line " +
    "WHERE aggregate.ent_topic.topic_id = aggregate.rel_topic_content.topic_id " +
    "AND aggregate.rel_topic_content.resource_id = aggregate.rel_resource_provider.resource_id " +
    "AND aggregate.ent_topic.domain = 'java' " +
    "AND aggregate.rel_resource_provider.provider_id = 'webex' " +
    "AND aggregate.rel_topic_content.display_name = webex21.ent_dissection.rdfID " +
    "AND webex21.ent_dissection.DissectionID = webex21.ent_line.DissectionID";
conn.query(queryString, function (error,results)
    {
        if(error)
        {
            throw error;
        }
        else
        {
            Annotated.big = results;
            var abc = (Annotated.big)
            //console.log(abc);
        }
    }
)



//Topic Names
var queryString2 = "SELECT display_name AS topic_name FROM aggregate.ent_topic WHERE domain = 'py';"
conn.query(queryString2, function (error,results2)
    {
        if(error)
        {
            throw error;
        }
        else
        {
            Annotated.title2 = results2;
            //console.log(Annotated.title2);
        }
    }
)
//records to create the smaller object
var queryString3 = "SELECT aggregate.ent_topic.display_name AS topic_name,aggregate.rel_topic_content.display_name AS rdf_id,webex21.ent_dissection.Name AS ex_name " +
    "FROM aggregate.ent_topic,aggregate.rel_topic_content,aggregate.rel_resource_provider,webex21.ent_dissection " +
    "WHERE aggregate.ent_topic.topic_id = aggregate.rel_topic_content.topic_id " +
    "AND aggregate.rel_topic_content.resource_id = aggregate.rel_resource_provider.resource_id " +
    "AND aggregate.ent_topic.domain = 'py' " +
    "AND aggregate.rel_resource_provider.provider_id = 'webex' " +
    "AND aggregate.rel_topic_content.display_name = webex21.ent_dissection.rdfID";
conn.query(queryString3, function (error,results3)
    {
        if(error)
        {
            throw error;
        }
        else
        {
            Annotated.title3 = results3;
            //console.log(Annotated.title3);

            var list1 = {};
            var list2 = [];

            Annotated.title3 = results3;

            var previous = ''
            for (i =0; i < Annotated.title3.length; i++)
            {
                var record = Annotated.title3[i];  //entire record
                var topic_name = record.topic_name;   //extracting topic name from record


                if (topic_name != previous)
                {
                    list1[topic_name] = [];
                    previous = topic_name;
                    var example_name = record.ex_name;
                    var rdfid = record.rdf_id;
                    list1[topic_name].push(rdfid);

                    //list1[topic_name].push(rdfid)
                    list2.push(topic_name);
                }
                else
                {
                    var example_name = record.ex_name;
                    var rdfid = record.rdf_id;
                    list1[topic_name].push(rdfid);
                }

            }
            Annotated.meta2 = list1
            console.log(Annotated.meta2);
            Annotated.title2 = list2;
            console.log(Annotated.title2);

        }
    }
)
conn.end();